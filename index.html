<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ovozli Musiqa va Video</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #FFD700;
            --secondary-color: #222;
            --text-color: #fff;
            --background-color: #111;
            --card-background: #222;
            --border-color: #333;
            --hover-color: #444;
            --active-color: #FFD700;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        body.light-theme {
            --primary-color: #FFD700;
            --secondary-color: #f5f5f5;
            --text-color: #333;
            --background-color: #f0f0f0;
            --card-background: #fff;
            --border-color: #ddd;
            --hover-color: #eee;
            --active-color: #FFD700;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        header {
            background-color: var(--secondary-color);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .logo i {
            margin-right: 0.5rem;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background-color: var(--card-background);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            flex-grow: 1;
            margin: 0 1rem;
        }
        
        .search-bar input {
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-color);
            width: 100%;
            margin-right: 0.5rem;
        }
        
        .search-bar button {
            background: transparent;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
        }
        
        .user-controls {
            display: flex;
            align-items: center;
        }
        
        .theme-toggle, .menu-toggle {
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 1rem;
            transition: color 0.3s ease;
        }
        
        .theme-toggle:hover, .menu-toggle:hover {
            color: var(--primary-color);
        }
        
        .current-time {
            font-size: 1.2rem;
            font-weight: bold;
            background-color: var(--card-background);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-left: 1rem;
        }
        
        main {
            display: flex;
            flex: 1;
            padding: 1rem;
        }
        
        .sidebar {
            width: 300px;
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            margin-right: 1rem;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }
        
        .sidebar-header {
            padding: 1rem;
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-header h3 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .upload-area {
            padding: 2rem;
            border: 2px dashed var(--border-color);
            border-radius: 4px;
            text-align: center;
            margin: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
        }
        
        .upload-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .upload-text {
            margin-bottom: 1rem;
        }
        
        .upload-button {
            background-color: var(--primary-color);
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        
        .upload-button:hover {
            background-color: #e6c300;
        }
        
        .playlist {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .empty-playlist {
            text-align: center;
            color: var(--text-color);
            opacity: 0.6;
            margin: 2rem 0;
        }
        
        .playlist-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            background-color: var(--secondary-color);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .playlist-item:hover {
            background-color: var(--hover-color);
        }
        
        .playlist-item.active {
            background-color: var(--active-color);
            color: #000;
        }
        
        .playlist-item-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .playlist-item-delete {
            background: transparent;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }
        
        .playlist-item:hover .playlist-item-delete {
            opacity: 1;
        }
        
        .playlist-item.active .playlist-item-delete {
            color: #000;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .player-container {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }
        
        .player-header {
            padding: 1rem;
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .player-header h3 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .media-container {
            position: relative;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 360px;
        }
        
        .media-icon {
            font-size: 6rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .player-title {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 1rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 80%;
        }
        
        .player-status {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 1rem;
        }
        
        audio, video {
            display: none;
            width: 100%;
            max-height: 360px;
            background-color: #000;
        }
        
        video {
            object-fit: contain;
        }
        
        .player-controls {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }
        
        .progress-container {
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--secondary-color);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 3px;
            width: 0%;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .control-button {
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            margin: 0 0.5rem;
            transition: color 0.3s ease;
        }
        
        .control-button:hover {
            color: var(--primary-color);
        }
        
        .control-button.active {
            color: var(--primary-color);
        }
        
        .play-button {
            font-size: 2rem;
            margin: 0 1rem;
        }
        
        .volume-controls {
            display: flex;
            align-items: center;
        }
        
        .volume-button {
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            margin-right: 0.5rem;
            transition: color 0.3s ease;
        }
        
        .volume-button:hover {
            color: var(--primary-color);
        }
        
        .volume-slider-container {
            width: 100px;
            height: 6px;
            background-color: var(--secondary-color);
            border-radius: 3px;
            position: relative;
        }
        
        .volume-level {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 3px;
            width: 80%;
        }
        
        .volume-slider {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .commands-container {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            flex: 1;
        }
        
        .commands-header {
            padding: 1rem;
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        .commands-header h3 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .commands-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .commands-table th, .commands-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .commands-table th {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .commands-table tr:hover td {
            background-color: var(--hover-color);
        }
        
        .youtube-container {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            margin-top: 1rem;
        }
        
        .youtube-header {
            padding: 1rem;
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .youtube-header h3 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .youtube-search {
            padding: 1rem;
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }
        
        .youtube-search input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px 0 0 4px;
            background-color: var(--background-color);
            color: var(--text-color);
            outline: none;
        }
        
        .youtube-search button {
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: #000;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        
        .youtube-search button:hover {
            background-color: #e6c300;
        }
        
        .youtube-player-container {
            padding: 1rem;
            display: flex;
            justify-content: center;
            min-height: 360px;
        }
        
        #youtube-player {
            width: 100%;
            background-color: #000;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: var(--card-background);
            color: var(--text-color);
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        footer {
            background-color: var(--secondary-color);
            padding: 1rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
        }
        
        footer p {
            margin: 0;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        @media (max-width: 768px) {
            header {
                flex-wrap: wrap;
            }
            
            .search-bar {
                width: 100%;
                margin: 1rem 0;
                display: flex;
            }
            
            .user-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .sidebar {
                width: 100%;
                margin-right: 0;
                margin-bottom: 1rem;
                transform: translateX(-120%);
                position: fixed;
                top: 60px;
                left: 0;
                bottom: 0;
                z-index: 100;
                border-radius: 0;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .menu-toggle {
                display: block;
            }
            
            .logo {
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .current-time {
                display: none;
            }
            
            .player-controls {
                padding: 0.5rem;
            }
            
            .control-button {
                font-size: 1rem;
                margin: 0 0.25rem;
            }
            
            .play-button {
                font-size: 1.5rem;
                margin: 0 0.5rem;
            }
            
            .volume-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-music"></i>
                Ovozli Musiqa va Video
            </div>
            
            <div class="search-bar">
                <input type="text" id="general-search-input" placeholder="Umumiy izlash...">
                <button id="general-search-button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div class="user-controls">
                <button id="theme-toggle" class="theme-toggle" aria-label="Mavzu o'zgartirish">
                    <i class="fas fa-sun"></i>
                </button>
                <button id="menu-toggle" class="menu-toggle" aria-label="Menyu ochish">
                    <i class="fas fa-bars"></i>
                </button>
                <div id="current-time" class="current-time">00:00:00</div>
            </div>
        </header>
        
        <main>
            <div id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <h3>
                        <i class="fas fa-list"></i>
                        Playlist
                    </h3>
                </div>
                
                <div id="upload-area" class="upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-upload"></i>
                    </div>
                    <p class="upload-text">MP3 yoki MP4 fayllarni yuklash uchun bosing yoki sudrab tashlang</p>
                    <button id="upload-button" class="upload-button">Fayllarni yuklash</button>
                    <input type="file" id="file-input" multiple accept="audio/*,video/*" style="display: none;">
                </div>
                
                <div class="playlist">
                    <div id="empty-playlist" class="empty-playlist">
                        <div class="media-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <p>Hozircha faylar yo'q</p>
                        <p>Fayllarni yuklash uchun yuqoridagi tugmani bosing</p>
                    </div>
                    
                    <div id="playlist-items">
                        <!-- Playlist items will be added here dynamically -->
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <div class="player-container">
                    <div class="player-header">
                        <h3>
                            <i class="fas fa-play-circle"></i>
                            Player
                        </h3>
                    </div>
                    
                    <div class="media-container">
                        <div class="media-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <h3 id="player-title" class="player-title">Hozir ijro etilmoqda...</h3>
                        <p id="player-status" class="player-status">Noma'lum</p>
                        
                        <audio id="audio-player" controls></audio>
                        <video id="video-player" controls></video>
                    </div>
                    
                    <div class="player-controls">
                        <div class="progress-container">
                            <div id="progress-bar" class="progress-bar">
                                <div id="progress-fill" class="progress-fill"></div>
                            </div>
                            <div class="time-display">
                                <span id="current-time">0:00</span>
                                <span id="duration">0:00</span>
                            </div>
                        </div>
                        
                        <div class="controls">
                            <button id="shuffle-button" class="control-button" aria-label="Aralashtirish">
                                <i class="fas fa-random"></i>
                            </button>
                            <button id="prev-button" class="control-button" aria-label="Avvalgi">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button id="play-button" class="control-button play-button" aria-label="Ijro et / To'xtat">
                                <i class="fas fa-play"></i>
                            </button>
                            <button id="next-button" class="control-button" aria-label="Keyingi">
                                <i class="fas fa-step-forward"></i>
                            </button>
                            <button id="repeat-button" class="control-button" aria-label="Takrorlash">
                                <i class="fas fa-redo-alt"></i>
                            </button>
                        </div>
                        
                        <div class="volume-controls">
                            <button id="mute-button" class="volume-button" aria-label="Ovozni o'chirish">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <div class="volume-slider-container">
                                <div id="volume-level" class="volume-level"></div>
                                <input id="volume-slider" class="volume-slider" type="range" min="0" max="100" value="80">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="commands-container">
                    <div class="commands-header">
                        <h3>
                            <i class="fas fa-keyboard"></i>
                            Buyruqlar Ro'yxati
                        </h3>
                    </div>
                    
                    <table class="commands-table">
                        <thead>
                            <tr>
                                <th>Buyruq raqami</th>
                                <th>O'zbek tilida</th>
                                <th>Русский языком</th>
                                <th>In English</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Balandlash (ovozni oshirish)</td>
                                <td>Увеличить (громкость)</td>
                                <td>Increase (volume)</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Pasaytirish (ovozni kamaytirish)</td>
                                <td>Уменьшить (громкость)</td>
                                <td>Decrease (volume)</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Keyingi</td>
                                <td>Следующий</td>
                                <td>Next</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>Avvalgi</td>
                                <td>Предыдущий</td>
                                <td>Previous</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>To'xtat</td>
                                <td>Пауза</td>
                                <td>Pause</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>Davom et</td>
                                <td>Продолжить</td>
                                <td>Continue</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>Ochir</td>
                                <td>Удалить</td>
                                <td>Delete</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>Ijro et / Oynat</td>
                                <td>Воспроизвести</td>
                                <td>Play</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td>To'xtatish</td>
                                <td>Стоп</td>
                                <td>Stop</td>
                            </tr>
                            <tr>
                                <td>10</td>
                                <td>Sukutlash (ovozni o'chirish) / Jim qilish</td>
                                <td>Выключить звук / Без звука</td>
                                <td>Mute</td>
                            </tr>
                            <tr>
                                <td>11</td>
                                <td>Qaytarish (takrorlash)</td>
                                <td>Повторить</td>
                                <td>Repeat</td>
                            </tr>
                            <tr>
                                <td>12</td>
                                <td>Aralashtirish (tasodifiy o'ynatish)</td>
                                <td>Случайный порядок / Перемешивание</td>
                                <td>Shuffle</td>
                            </tr>
                            <tr>
                                <td>13</td>
                                <td>Qidirish</td>
                                <td>Поиск</td>
                                <td>Search</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="youtube-container">
                    <div class="youtube-header">
                        <h3>
                            <i class="fab fa-youtube"></i>
                            YouTube
                        </h3>
                    </div>
                    
                    <div class="youtube-search">
                        <input type="text" id="youtube-search-input" placeholder="YouTube da izlash...">
                        <button id="youtube-search-button">
                            <i class="fas fa-search"></i>
                            Izlash
                        </button>
                    </div>
                    
                    <div class="youtube-player-container">
                        <div id="youtube-player">
                            YouTube video player will appear here
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>© 2025 Ovozli Musiqa va Video. Barcha huquqlar himoyalangan.</p>
        </footer>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // YouTube API
        let player;
        const API_KEY = 'AIzaSyAhB79h7SAKIwUiXt-pYlNmmPL_bhZ2_uQ'; // Replace with your actual YouTube API key
        
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '360',
                width: '100%',
                videoId: 'g9_4yUWZQ8I',
                playerVars: {
                    'playsinline': 1,
                    'controls': 1,
                    'autoplay': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }
        
        function onPlayerReady(event) {
            console.log('YouTube player is ready');
        }
        
        function onPlayerStateChange(event) {
            // Handle state changes if needed
        }
        
        document.getElementById('youtube-search-button').addEventListener('click', searchYouTube);
        document.getElementById('youtube-search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchYouTube();
        });
        
        function searchYouTube() {
            const query = document.getElementById('youtube-search-input').value.trim();
            if (query) {
                fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.items && data.items.length > 0) {
                            const videoId = data.items[0].id.videoId;
                            player.loadVideoById(videoId);
                            showNotification(`"${query}" videolari topildi`);
                        } else {
                            showNotification('Video topilmadi');
                        }
                    })
                    .catch(error => {
                        console.error('YouTube search error:', error);
                        showNotification('YouTube qidirishda xatolik');
                    });
            }
        }
        
        // Local audio/video player
        const audioPlayer = document.getElementById('audio-player');
        const videoPlayer = document.getElementById('video-player');
        const playButton = document.getElementById('play-button');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const shuffleButton = document.getElementById('shuffle-button');
        const repeatButton = document.getElementById('repeat-button');
        const progressBar = document.getElementById('progress-bar');
        const progressFill = document.getElementById('progress-fill');
        const currentTimeElement = document.getElementById('current-time');
        const durationElement = document.getElementById('duration');
        const playerTitle = document.getElementById('player-title');
        const playerStatus = document.getElementById('player-status');
        const muteButton = document.getElementById('mute-button');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeLevel = document.getElementById('volume-level');
        const playlistItems = document.getElementById('playlist-items');
        const emptyPlaylist = document.getElementById('empty-playlist');
        const fileInput = document.getElementById('file-input');
        const uploadButton = document.getElementById('upload-button');
        const uploadArea = document.getElementById('upload-area');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const themeToggle = document.getElementById('theme-toggle');
        const notification = document.getElementById('notification');
        const currentTimeDisplay = document.getElementById('current-time');
        const generalSearchButton = document.getElementById('general-search-button');
        const generalSearchInput = document.getElementById('general-search-input');

        let playlist = [];
        let currentTrackIndex = -1;
        let isPlaying = false;
        let isShuffle = false;
        let repeatMode = 'none';
        let currentMedia = null;

        function updateCurrentTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            currentTimeDisplay.textContent = `${hours}:${minutes}:${seconds}`;
        }

        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            if (document.body.classList.contains('light-theme')) {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                showNotification('Yorug\' mavzu yoqildi');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                showNotification('Qorong\'u mavzu yoqildi');
            }
        });

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('show');
        });

        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        uploadButton.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary-color)';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = 'var(--border-color)';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--border-color)';
            if (e.dataTransfer.files.length > 0) handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) handleFiles(fileInput.files);
        });

        function handleFiles(files) {
            const mediaFiles = Array.from(files).filter(file => 
                file.type.startsWith('audio/') || file.type.startsWith('video/')
            );
            if (mediaFiles.length > 0) {
                mediaFiles.forEach(file => addToPlaylist(file));
                showNotification(`${mediaFiles.length} fayl yuklandi`);
            } else {
                showNotification('Qo\'llab-quvvatlanmaydigan fayl turi');
            }
        }

        function addToPlaylist(file) {
            const fileURL = URL.createObjectURL(file);
            const fileType = file.type.startsWith('audio/') ? 'audio' : 'video';
            const track = { name: file.name, url: fileURL, type: fileType };
            playlist.push(track);
            updatePlaylistUI();
            if (playlist.length === 1) loadTrack(0);
        }

        function updatePlaylistUI() {
            if (playlist.length > 0) {
                emptyPlaylist.style.display = 'none';
                playlistItems.innerHTML = '';
                playlist.forEach((track, index) => {
                    const item = document.createElement('div');
                    item.className = 'playlist-item';
                    if (index === currentTrackIndex) item.classList.add('active');
                    item.innerHTML = `
                        <div class="playlist-item-name">
                            <i class="fas fa-${track.type === 'audio' ? 'music' : 'film'}"></i>
                            ${track.name}
                        </div>
                        <button class="playlist-item-delete" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    item.addEventListener('click', (e) => {
                        if (!e.target.closest('.playlist-item-delete')) loadTrack(index);
                    });
                    playlistItems.appendChild(item);
                });
                document.querySelectorAll('.playlist-item-delete').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const index = parseInt(button.getAttribute('data-index'));
                        removeFromPlaylist(index);
                    });
                });
            } else {
                emptyPlaylist.style.display = 'block';
                playlistItems.innerHTML = '';
            }
        }

        function removeFromPlaylist(index) {
            if (index === currentTrackIndex) {
                stopPlayback();
                currentTrackIndex = -1;
            } else if (index < currentTrackIndex) {
                currentTrackIndex--;
            }
            playlist.splice(index, 1);
            updatePlaylistUI();
            showNotification('Fayl o\'chirildi');
            if (playlist.length > 0 && currentTrackIndex === -1) loadTrack(0);
        }

        function loadTrack(index) {
            if (index >= 0 && index < playlist.length) {
                stopPlayback();
                currentTrackIndex = index;
                const track = playlist[index];
                playerTitle.textContent = track.name;
                playerStatus.textContent = track.type === 'audio' ? 'Audio' : 'Video';
                if (track.type === 'audio') {
                    audioPlayer.src = track.url;
                    videoPlayer.style.display = 'none';
                    audioPlayer.style.display = 'block';
                    currentMedia = audioPlayer;
                    document.querySelector('.media-icon').innerHTML = '<i class="fas fa-music"></i>';
                } else {
                    videoPlayer.src = track.url;
                    audioPlayer.style.display = 'none';
                    videoPlayer.style.display = 'block';
                    currentMedia = videoPlayer;
                    document.querySelector('.media-icon').innerHTML = '<i class="fas fa-film"></i>';
                }
                updatePlaylistUI();
                playTrack();
            }
        }

        function playTrack() {
            if (currentMedia) {
                currentMedia.play().then(() => {
                    isPlaying = true;
                    playButton.innerHTML = '<i class="fas fa-pause"></i>';
                    document.querySelector('.media-icon').style.display = 'none';
                }).catch(error => {
                    console.error('Playback error:', error);
                    showNotification('Ijro etishda xatolik');
                });
            }
        }

        function pauseTrack() {
            if (currentMedia && !currentMedia.paused) {
                currentMedia.pause();
                isPlaying = false;
                playButton.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        function stopPlayback() {
            if (currentMedia) {
                currentMedia.pause();
                currentMedia.currentTime = 0;
                isPlaying = false;
                playButton.innerHTML = '<i class="fas fa-play"></i>';
                document.querySelector('.media-icon').style.display = 'block';
            }
        }

        function playNextTrack() {
            if (playlist.length === 0) return;
            let nextIndex = isShuffle ? Math.floor(Math.random() * playlist.length) : (currentTrackIndex + 1) % playlist.length;
            loadTrack(nextIndex);
        }

        function playPrevTrack() {
            if (playlist.length === 0) return;
            let prevIndex = currentTrackIndex > 0 ? currentTrackIndex - 1 : playlist.length - 1;
            loadTrack(prevIndex);
        }

        playButton.addEventListener('click', () => {
            if (currentMedia) {
                if (isPlaying) pauseTrack();
                else playTrack();
            } else if (playlist.length > 0) loadTrack(0);
        });

        prevButton.addEventListener('click', playPrevTrack);
        nextButton.addEventListener('click', playNextTrack);

        shuffleButton.addEventListener('click', () => {
            isShuffle = !isShuffle;
            shuffleButton.classList.toggle('active', isShuffle);
            showNotification(isShuffle ? 'Aralashtirish yoqildi' : 'Aralashtirish o\'chirildi');
        });

        repeatButton.addEventListener('click', () => {
            if (repeatMode === 'none') {
                repeatMode = 'one';
                repeatButton.classList.add('active');
                repeatButton.innerHTML = '<i class="fas fa-redo-alt"></i><span>1</span>';
                showNotification('Bir marta takrorlash');
            } else if (repeatMode === 'one') {
                repeatMode = 'all';
                repeatButton.innerHTML = '<i class="fas fa-redo-alt"></i>';
                showNotification('Hammasini takrorlash');
            } else {
                repeatMode = 'none';
                repeatButton.classList.remove('active');
                showNotification('Takrorlash o\'chirildi');
            }
        });

        function setupMediaListeners(media) {
            media.addEventListener('timeupdate', updateProgress);
            media.addEventListener('ended', handleTrackEnd);
            media.addEventListener('loadedmetadata', updateDuration);
        }

        setupMediaListeners(audioPlayer);
        setupMediaListeners(videoPlayer);

        function updateProgress() {
            if (currentMedia) {
                const percent = (currentMedia.currentTime / currentMedia.duration) * 100;
                progressFill.style.width = `${percent}%`;
                currentTimeElement.textContent = formatTime(currentMedia.currentTime);
            }
        }

        function updateDuration() {
            if (currentMedia && !isNaN(currentMedia.duration)) {
                durationElement.textContent = formatTime(currentMedia.duration);
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        function handleTrackEnd() {
            if (repeatMode === 'one') {
                currentMedia.currentTime = 0;
                playTrack();
            } else if (repeatMode === 'all' || currentTrackIndex < playlist.length - 1) {
                playNextTrack();
            } else {
                stopPlayback();
                currentMedia.currentTime = 0;
            }
        }

        progressBar.addEventListener('click', (e) => {
            if (currentMedia && currentMedia.duration) {
                const rect = progressBar.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                currentMedia.currentTime = percent * currentMedia.duration;
            }
        });

        muteButton.addEventListener('click', () => {
            if (currentMedia) {
                currentMedia.muted = !currentMedia.muted;
                if (currentMedia.muted) {
                    muteButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    volumeLevel.style.width = '0%';
                    showNotification('Ovoz o\'chirildi');
                } else {
                    muteButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                    volumeLevel.style.width = `${volumeSlider.value}%`;
                    showNotification('Ovoz yoqildi');
                }
            }
        });

        volumeSlider.addEventListener('input', () => {
            const volumeValue = volumeSlider.value;
            if (currentMedia) {
                currentMedia.volume = volumeValue / 100;
                currentMedia.muted = false;
                volumeLevel.style.width = `${volumeValue}%`;
                muteButton.innerHTML = volumeValue > 50 ? '<i class="fas fa-volume-up"></i>' : 
                                      volumeValue > 0 ? '<i class="fas fa-volume-down"></i>' : 
                                      '<i class="fas fa-volume-mute"></i>';
            }
        });

        volumeSlider.value = 80;
        volumeLevel.style.width = '80%';

        // General search (placeholder functionality)
        generalSearchButton.addEventListener('click', () => {
            const query = generalSearchInput.value.trim();
            if (query) showNotification(`Umumiy qidiruv: "${query}"`);
        });

        generalSearchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') generalSearchButton.click();
        });

        // Voice recognition
        if ('webkitSpeechRecognition' in window) {
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = false;
            recognition.lang = 'uz-UZ';

            recognition.onresult = function(event) {
                const command = event.results[event.results.length - 1][0].transcript.toLowerCase();
                processVoiceCommand(command);
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                showNotification('Ovozli buyruqda xatolik');
            };

            function startVoiceRecognition() {
                try {
                    recognition.start();
                    showNotification('Ovozli buyruqlar yoqildi');
                } catch (e) {
                    console.error('Could not start speech recognition', e);
                }
            }

            // Start recognition on page load and say greeting
            window.addEventListener('load', () => {
                speak('Assalomu alekum siz qanday tarona hohlayapsiz');
                setTimeout(startVoiceRecognition, 1000); // Delay to ensure greeting is spoken first
            });

            let resumeTimeout;
            function processVoiceCommand(command) {
                if (command.includes('aziza')) {
                    pauseTrack();
                    speak('Assalomu alekum siz qanday tarona hohlayapsiz');
                    clearTimeout(resumeTimeout);
                    resumeTimeout = setTimeout(() => {
                        if (!isPlaying) playTrack();
                    }, 15000);
                } else if (command.includes('labay')) {
                    speak('Labay');
                    clearTimeout(resumeTimeout);
                    resumeTimeout = setTimeout(() => {
                        if (!isPlaying) playTrack();
                    }, 15000);
                } else if (command.includes('balandlash') || command.includes('oshirish') || 
                           command.includes('увеличить') || command.includes('increase')) {
                    increaseVolume();
                } else if (command.includes('pasaytirish') || command.includes('kamaytirish') || 
                           command.includes('уменьшить') || command.includes('decrease')) {
                    decreaseVolume();
                } else if (command.includes('keyingi') || command.includes('следующий') || 
                           command.includes('next')) {
                    playNextTrack();
                } else if (command.includes('avvalgi') || command.includes('предыдущий') || 
                           command.includes('previous')) {
                    playPrevTrack();
                } else if (command.includes('to\'xtat') || command.includes('пауза') || 
                           command.includes('pause')) {
                    pauseTrack();
                } else if (command.includes('davom et') || command.includes('продолжить') || 
                           command.includes('continue')) {
                    playTrack();
                } else if (command.includes('ochir') || command.includes('удалить') || 
                           command.includes('delete')) {
                    if (currentTrackIndex >= 0) removeFromPlaylist(currentTrackIndex);
                } else if (command.includes('ijro et') || command.includes('oynat') || 
                           command.includes('воспроизвести') || command.includes('play')) {
                    playTrack();
                } else if (command.includes('to\'xtatish') || command.includes('стоп') || 
                           command.includes('stop')) {
                    stopPlayback();
                } else if (command.includes('sukutlash') || command.includes('jim') || 
                           command.includes('без звука') || command.includes('выключить звук') || 
                           command.includes('mute')) {
                    toggleMute();
                } else if (command.includes('qaytarish') || command.includes('takrorlash') || 
                           command.includes('повторить') || command.includes('repeat')) {
                    toggleRepeat();
                } else if (command.includes('aralashtirish') || command.includes('случайный') || 
                           command.includes('перемешивание') || command.includes('shuffle')) {
                    toggleShuffle();
                } else if (command.includes('qidirish') || command.includes('поиск') || 
                           command.includes('search')) {
                    const query = generalSearchInput.value.trim() || 'default search';
                    showNotification(`Qidiruv: "${query}"`);
                    searchYouTube(query); // Optionally trigger YouTube search
                }
            }

            function speak(text) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'uz-UZ';
                speechSynthesis.speak(utterance);
            }

            function increaseVolume() {
                const newVolume = Math.min(100, parseInt(volumeSlider.value) + 10);
                volumeSlider.value = newVolume;
                volumeSlider.dispatchEvent(new Event('input'));
                showNotification(`Ovoz ${newVolume}%`);
            }

            function decreaseVolume() {
                const newVolume = Math.max(0, parseInt(volumeSlider.value) - 10);
                volumeSlider.value = newVolume;
                volumeSlider.dispatchEvent(new Event('input'));
                showNotification(`Ovoz ${newVolume}%`);
            }

            function toggleMute() {
                if (currentMedia) muteButton.click();
            }

            function toggleRepeat() {
                repeatButton.click();
            }

            function toggleShuffle() {
                shuffleButton.click();
            }
        }
    </script>
</body>
</html>
